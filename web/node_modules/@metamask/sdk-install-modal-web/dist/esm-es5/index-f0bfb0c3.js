var __spreadArray=this&&this.__spreadArray||function(r,n,e){if(e||arguments.length===2)for(var t=0,i=n.length,a;t<i;t++){if(a||!(t in n)){if(!a)a=Array.prototype.slice.call(n,0,t);a[t]=n[t]}}return r.concat(a||Array.prototype.slice.call(n))};
/*!
Copyright (c) 2023 Paul Miller (paulmillr.com)
The library @paulmillr/qr is dual-licensed under the Apache 2.0 OR MIT license.
You can select a license of your choice.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/function assertNumber(r){if(!Number.isSafeInteger(r))throw new Error("Wrong integer: ".concat(r))}function validateVersion(r){if(!Number.isSafeInteger(r)||r<1||r>40)throw new Error("Invalid version=".concat(r,". Expected number [1..40]"))}function bin(r,n){return r.toString(2).padStart(n,"0")}function mod(r,n){var e=r%n;return e>=0?e:n+e}function fillArr(r,n){return new Array(r).fill(n)}function interleaveBytes(){var r=[];for(var n=0;n<arguments.length;n++){r[n]=arguments[n]}var e=0;for(var t=0,i=r;t<i.length;t++){var a=i[t];e=Math.max(e,a.length)}var o=[];for(var f=0;f<e;f++){for(var u=0,v=r;u<v.length;u++){var a=v[u];if(f>=a.length)continue;o.push(a[f])}}return new Uint8Array(o)}function includesAt(r,n,e){if(e<0||e+n.length>r.length)return false;for(var t=0;t<n.length;t++)if(n[t]!==r[e+t])return false;return true}function best(){var r;var n=Infinity;return{add:function(e,t){if(e>=n)return;r=t;n=e},get:function(){return r},score:function(){return n}}}function alphabet(r){return{has:function(n){return r.includes(n)},decode:function(n){if(!Array.isArray(n)||n.length&&typeof n[0]!=="string")throw new Error("alphabet.decode input should be array of strings");return n.map((function(n){if(typeof n!=="string")throw new Error("alphabet.decode: not string element=".concat(n));var e=r.indexOf(n);if(e===-1)throw new Error('Unknown letter: "'.concat(n,'". Allowed: ').concat(r));return e}))},encode:function(n){if(!Array.isArray(n)||n.length&&typeof n[0]!=="number")throw new Error("alphabet.encode input should be an array of numbers");return n.map((function(n){assertNumber(n);if(n<0||n>=r.length)throw new Error("Digit index outside alphabet: ".concat(n," (alphabet: ").concat(r.length,")"));return r[n]}))}}}var Bitmap=function(){function r(n,e){var t=r.size(n),i=t.height,a=t.width;this.data=e||Array.from({length:i},(function(){return fillArr(a,undefined)}));this.height=i;this.width=a}r.size=function(r,n){if(typeof r==="number")r={height:r,width:r};if(!Number.isSafeInteger(r.height)&&r.height!==Infinity)throw new Error("Bitmap: wrong height=".concat(r.height," (").concat(typeof r.height,")"));if(!Number.isSafeInteger(r.width)&&r.width!==Infinity)throw new Error("Bitmap: wrong width=".concat(r.width," (").concat(typeof r.width,")"));if(n!==undefined){r={width:Math.min(r.width,n.width),height:Math.min(r.height,n.height)}}return r};r.fromString=function(n){n=n.replace(/^\n+/g,"").replace(/\n+$/g,"");var e=n.split("\n");var t=e.length;var i=new Array(t);var a;for(var o=0,f=e;o<f.length;o++){var u=f[o];var v=u.split("").map((function(r){if(r==="X")return true;if(r===" ")return false;if(r==="?")return undefined;throw new Error("Bitmap.fromString: unknown symbol=".concat(r))}));if(a&&v.length!==a)throw new Error("Bitmap.fromString different row sizes: width=".concat(a," cur=").concat(v.length));a=v.length;i.push(v)}if(!a)a=0;return new r({height:t,width:a},i)};r.prototype.point=function(r){return this.data[r.y][r.x]};r.prototype.isInside=function(r){return 0<=r.x&&r.x<this.width&&0<=r.y&&r.y<this.height};r.prototype.size=function(r){if(!r)return{height:this.height,width:this.width};var n=this.xy(r),e=n.x,t=n.y;return{height:this.height-t,width:this.width-e}};r.prototype.xy=function(r){if(typeof r==="number")r={x:r,y:r};if(!Number.isSafeInteger(r.x))throw new Error("Bitmap: wrong x=".concat(r.x));if(!Number.isSafeInteger(r.y))throw new Error("Bitmap: wrong y=".concat(r.y));r.x=mod(r.x,this.width);r.y=mod(r.y,this.height);return r};r.prototype.rect=function(n,e,t){var i=this.xy(n),a=i.x,o=i.y;var f=r.size(e,this.size({x:a,y:o})),u=f.height,v=f.width;for(var c=0;c<u;c++){for(var d=0;d<v;d++){this.data[o+c][a+d]=typeof t==="function"?t({x:d,y:c},this.data[o+c][a+d]):t}}return this};r.prototype.rectRead=function(r,n,e){return this.rect(r,n,(function(r,n){e(r,n);return n}))};r.prototype.hLine=function(r,n,e){return this.rect(r,{width:n,height:1},e)};r.prototype.vLine=function(r,n,e){return this.rect(r,{width:1,height:n},e)};r.prototype.border=function(n,e){if(n===void 0){n=2}var t=this.height+2*n;var i=this.width+2*n;var a=fillArr(n,e);var o=Array.from({length:n},(function(){return fillArr(i,e)}));return new r({height:t,width:i},__spreadArray(__spreadArray(__spreadArray([],o,true),this.data.map((function(r){return __spreadArray(__spreadArray(__spreadArray([],a,true),r,true),a,true)})),true),o,true))};r.prototype.embed=function(r,n){return this.rect(r,n.size(),(function(r){var e=r.x,t=r.y;return n.data[t][e]}))};r.prototype.rectSlice=function(n,e){if(e===void 0){e=this.size()}var t=new r(r.size(e,this.size(this.xy(n))));this.rect(n,e,(function(r,n){var e=r.x,i=r.y;return t.data[i][e]=n}));return t};r.prototype.inverse=function(){var n=this;var e=this,t=e.height,i=e.width;var a=new r({height:i,width:t});return a.rect({x:0,y:0},Infinity,(function(r){var e=r.x,t=r.y;return n.data[e][t]}))};r.prototype.scale=function(n){var e=this;if(!Number.isSafeInteger(n)||n>1024)throw new Error("Wrong scale factor: ".concat(n));var t=this,i=t.height,a=t.width;var o=new r({height:n*i,width:n*a});return o.rect({x:0,y:0},Infinity,(function(r){var t=r.x,i=r.y;return e.data[Math.floor(i/n)][Math.floor(t/n)]}))};r.prototype.clone=function(){var n=this;var e=new r(this.size());return e.rect({x:0,y:0},this.size(),(function(r){var e=r.x,t=r.y;return n.data[t][e]}))};r.prototype.assertDrawn=function(){this.rectRead(0,Infinity,(function(r,n){if(typeof n!=="boolean")throw new Error("Invalid color type=".concat(typeof n))}))};r.prototype.toString=function(){return this.data.map((function(r){return r.map((function(r){return r===undefined?"?":r?"X":" "})).join("")})).join("\n")};r.prototype.toASCII=function(){var r=this,n=r.height,e=r.width,t=r.data;var i="";for(var a=0;a<n;a+=2){for(var o=0;o<e;o++){var f=t[a][o];var u=a+1>=n?true:t[a+1][o];if(!f&&!u)i+="â–ˆ";else if(!f&&u)i+="â–€";else if(f&&!u)i+="â–„";else if(f&&u)i+=" "}i+="\n"}return i};r.prototype.toTerm=function(){var r="[0m";var n="[1;47m  ".concat(r);var e="[40m  ".concat(r);return this.data.map((function(r){return r.map((function(r){return r?e:n})).join("")})).join("\n")};r.prototype.toSVG=function(){var r='<svg xmlns:svg="http://www.w3.org/2000/svg" viewBox="0 0 '.concat(this.width," ").concat(this.height,'" version="1.1" xmlns="http://www.w3.org/2000/svg">');this.rectRead(0,Infinity,(function(n,e){var t=n.x,i=n.y;if(e)r+='<rect x="'.concat(t,'" y="').concat(i,'" width="1" height="1" />')}));r+="</svg>";return r};r.prototype.toGIF=function(){var r=function(r){return[r&255,r>>>8&255]};var n=__spreadArray(__spreadArray([],r(this.width),true),r(this.height),true);var e=[];this.rectRead(0,Infinity,(function(r,n){return e.push(+(n===true))}));var t=126;var i=__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([71,73,70,56,55,97],n,true),[246,0,0,255,255,255],false),fillArr(3*127,0),true),[44,0,0,0,0],false),n,true),[0,7],false);var a=Math.floor(e.length/t);for(var o=0;o<a;o++)i.push.apply(i,__spreadArray([t+1,128],e.slice(t*o,t*(o+1)).map((function(r){return+r})),false));i.push.apply(i,__spreadArray([e.length%t+1,128],e.slice(a*t).map((function(r){return+r})),false));i.push(1,129,0,59);return new Uint8Array(i)};r.prototype.toImage=function(r){if(r===void 0){r=false}var n=this.size(),e=n.height,t=n.width;var i=new Uint8Array(e*t*(r?3:4));var a=0;for(var o=0;o<e;o++){for(var f=0;f<t;f++){var u=!!this.data[o][f]?0:255;i[a++]=u;i[a++]=u;i[a++]=u;if(!r)i[a++]=255}}return{height:e,width:t,data:i}};return r}();var ECMode=["low","medium","quartile","high"];var Encoding=["numeric","alphanumeric","byte","kanji","eci"];var BYTES=[26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];var WORDS_PER_BLOCK={low:[7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],medium:[10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],quartile:[13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],high:[17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]};var ECC_BLOCKS={low:[1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],medium:[1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],quartile:[1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],high:[1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]};var info={size:{encode:function(r){return 21+4*(r-1)},decode:function(r){return(r-17)/4}},sizeType:function(r){return Math.floor((r+7)/17)},alignmentPatterns:function(r){if(r===1)return[];var n=6;var e=info.size.encode(r)-n-1;var t=e-n;var i=Math.ceil(t/28);var a=Math.floor(t/i);if(a%2)a+=1;else if(t%i*2>=i)a+=2;var o=[n];for(var f=1;f<i;f++)o.push(e-(i-f)*a);o.push(e);return o},ECCode:{low:1,medium:0,quartile:3,high:2},formatMask:21522,formatBits:function(r,n){var e=info.ECCode[r]<<3|n;var t=e;for(var i=0;i<10;i++)t=t<<1^(t>>9)*1335;return(e<<10|t)^info.formatMask},versionBits:function(r){var n=r;for(var e=0;e<12;e++)n=n<<1^(n>>11)*7973;return r<<12|n},alphabet:{numeric:alphabet("0123456789"),alphanumerc:alphabet("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:")},lengthBits:function(r,n){var e={numeric:[10,12,14],alphanumeric:[9,11,13],byte:[8,16,16],kanji:[8,10,12],eci:[0,0,0]};return e[n][info.sizeType(r)]},modeBits:{numeric:"0001",alphanumeric:"0010",byte:"0100",kanji:"1000",eci:"0111"},capacity:function(r,n){var e=BYTES[r-1];var t=WORDS_PER_BLOCK[n][r-1];var i=ECC_BLOCKS[n][r-1];var a=Math.floor(e/i)-t;var o=i-e%i;return{words:t,numBlocks:i,shortBlocks:o,blockLen:a,capacity:(e-t*i)*8,total:(t+a)*i+i-o}}};var PATTERNS=[function(r,n){return(r+n)%2==0},function(r,n){return n%2==0},function(r,n){return r%3==0},function(r,n){return(r+n)%3==0},function(r,n){return(Math.floor(n/2)+Math.floor(r/3))%2==0},function(r,n){return r*n%2+r*n%3==0},function(r,n){return(r*n%2+r*n%3)%2==0},function(r,n){return((r+n)%2+r*n%3)%2==0}];var GF={tables:function(r){var n=fillArr(256,0);var e=fillArr(256,0);for(var t=0,i=1;t<256;t++){n[t]=i;e[i]=t;i<<=1;if(i&256)i^=r}return{exp:n,log:e}}(285),exp:function(r){return GF.tables.exp[r]},log:function(r){if(r===0)throw new Error("GF.log: wrong arg=".concat(r));return GF.tables.log[r]%255},mul:function(r,n){if(r===0||n===0)return 0;return GF.tables.exp[(GF.tables.log[r]+GF.tables.log[n])%255]},add:function(r,n){return r^n},pow:function(r,n){return GF.tables.exp[GF.tables.log[r]*n%255]},inv:function(r){if(r===0)throw new Error("GF.inverse: wrong arg=".concat(r));return GF.tables.exp[255-GF.tables.log[r]]},polynomial:function(r){if(r.length==0)throw new Error("GF.polymomial: wrong length");if(r[0]!==0)return r;var n=0;for(;n<r.length-1&&r[n]==0;n++);return r.slice(n)},monomial:function(r,n){if(r<0)throw new Error("GF.monomial: wrong degree=".concat(r));if(n==0)return[0];var e=fillArr(r+1,0);e[0]=n;return GF.polynomial(e)},degree:function(r){return r.length-1},coefficient:function(r,n){return r[GF.degree(r)-n]},mulPoly:function(r,n){if(r[0]===0||n[0]===0)return[0];var e=fillArr(r.length+n.length-1,0);for(var t=0;t<r.length;t++){for(var i=0;i<n.length;i++){e[t+i]=GF.add(e[t+i],GF.mul(r[t],n[i]))}}return GF.polynomial(e)},mulPolyScalar:function(r,n){if(n==0)return[0];if(n==1)return r;var e=fillArr(r.length,0);for(var t=0;t<r.length;t++)e[t]=GF.mul(r[t],n);return GF.polynomial(e)},mulPolyMonomial:function(r,n,e){if(n<0)throw new Error("GF.mulPolyMonomial: wrong degree");if(e==0)return[0];var t=fillArr(r.length+n,0);for(var i=0;i<r.length;i++)t[i]=GF.mul(r[i],e);return GF.polynomial(t)},addPoly:function(r,n){var e;if(r[0]===0)return n;if(n[0]===0)return r;var t=r;var i=n;if(t.length>i.length)e=[i,t],t=e[0],i=e[1];var a=fillArr(i.length,0);var o=i.length-t.length;var f=i.slice(0,o);for(var u=0;u<f.length;u++)a[u]=f[u];for(var u=o;u<i.length;u++)a[u]=GF.add(t[u-o],i[u]);return GF.polynomial(a)},remainderPoly:function(r,n){var e=Array.from(r);for(var t=0;t<r.length-n.length+1;t++){var i=e[t];if(i===0)continue;for(var a=1;a<n.length;a++){if(n[a]!==0)e[t+a]=GF.add(e[t+a],GF.mul(n[a],i))}}return e.slice(r.length-n.length+1,e.length)},divisorPoly:function(r){var n=[1];for(var e=0;e<r;e++)n=GF.mulPoly(n,[1,GF.pow(2,e)]);return n},evalPoly:function(r,n){if(n==0)return GF.coefficient(r,0);var e=r[0];for(var t=1;t<r.length;t++)e=GF.add(GF.mul(n,e),r[t]);return e},euclidian:function(r,n,e){var t;if(GF.degree(r)<GF.degree(n))t=[n,r],r=t[0],n=t[1];var i=r;var a=n;var o=[0];var f=[1];while(2*GF.degree(a)>=e){var u=i;var v=o;i=a;o=f;if(i[0]===0)throw new Error("rLast[0] === 0");a=u;var c=[0];var d=GF.inv(i[0]);while(GF.degree(a)>=GF.degree(i)&&a[0]!==0){var s=GF.degree(a)-GF.degree(i);var h=GF.mul(a[0],d);c=GF.addPoly(c,GF.monomial(s,h));a=GF.addPoly(a,GF.mulPolyMonomial(i,s,h))}c=GF.mulPoly(c,o);f=GF.addPoly(c,v);if(GF.degree(a)>=GF.degree(i))throw new Error("Division failed r: ".concat(a,", rLast: ").concat(i))}var l=GF.coefficient(f,0);if(l==0)throw new Error("sigmaTilde(0) was zero");var w=GF.inv(l);return[GF.mulPolyScalar(f,w),GF.mulPolyScalar(a,w)]}};function RS(r){return{encode:function(n){var e=GF.divisorPoly(r);var t=Array.from(n);t.push.apply(t,e.slice(0,-1).fill(0));return Uint8Array.from(GF.remainderPoly(t,e))},decode:function(n){var e=n.slice();var t=GF.polynomial(Array.from(n));var i=fillArr(r,0);var a=false;for(var o=0;o<r;o++){var f=GF.evalPoly(t,GF.exp(o));i[i.length-1-o]=f;if(f!==0)a=true}if(!a)return e;i=GF.polynomial(i);var u=GF.monomial(r,1);var v=GF.euclidian(u,i,r),c=v[0],d=v[1];var s=fillArr(GF.degree(c),0);var h=0;for(var o=1;o<256&&h<s.length;o++){if(GF.evalPoly(c,o)===0)s[h++]=GF.inv(o)}if(h!==s.length)throw new Error("RS.decode: wrong errors number");for(var o=0;o<s.length;o++){var l=e.length-1-GF.log(s[o]);if(l<0)throw new Error("RS.decode: wrong error location");var w=GF.inv(s[o]);var y=1;for(var p=0;p<s.length;p++){if(o===p)continue;y=GF.mul(y,GF.add(1,GF.mul(s[p],w)))}e[l]=GF.add(e[l],GF.mul(GF.evalPoly(d,w),GF.inv(y)))}return e}}}function interleave(r,n){var e=info.capacity(r,n),t=e.words,i=e.shortBlocks,a=e.numBlocks,o=e.blockLen,f=e.total;var u=RS(t);return{encode:function(r){var n=[];var e=[];for(var t=0;t<a;t++){var f=t<i;var v=o+(f?0:1);n.push(r.subarray(0,v));e.push(u.encode(r.subarray(0,v)));r=r.subarray(v)}var c=interleaveBytes.apply(void 0,n);var d=interleaveBytes.apply(void 0,e);var s=new Uint8Array(c.length+d.length);s.set(c);s.set(d,c.length);return s},decode:function(r){if(r.length!==f)throw new Error("interleave.decode: len(data)=".concat(r.length,", total=").concat(f));var n=[];for(var e=0;e<a;e++){var v=e<i;n.push(new Uint8Array(t+o+(v?0:1)))}var c=0;for(var e=0;e<o;e++){for(var d=0;d<a;d++)n[d][e]=r[c++]}for(var d=i;d<a;d++)n[d][o]=r[c++];for(var e=o;e<o+t;e++){for(var d=0;d<a;d++){var v=d<i;n[d][e+(v?0:1)]=r[c++]}}var s=[];for(var h=0,l=n;h<l.length;h++){var w=l[h];s.push.apply(s,Array.from(u.decode(w)).slice(0,-t))}return Uint8Array.from(s)}}}function drawTemplate(r,n,e,t){if(t===void 0){t=false}var i=info.size.encode(r);var a=new Bitmap(i+2);var o=new Bitmap(3).rect(0,3,true).border(1,false).border(1,true).border(1,false);a=a.embed(0,o).embed({x:-o.width,y:0},o).embed({x:0,y:-o.height},o);a=a.rectSlice(1,i);var f=new Bitmap(1).rect(0,1,true).border(1,false).border(1,true);var u=info.alignmentPatterns(r);for(var v=0,c=u;v<c.length;v++){var d=c[v];for(var s=0,h=u;s<h.length;s++){var l=h[s];if(a.data[d][l]!==undefined)continue;a.embed({x:l-2,y:d-2},f)}}a=a.hLine({x:0,y:6},Infinity,(function(r,n){var e=r.x;return n===undefined?e%2==0:n})).vLine({x:6,y:0},Infinity,(function(r,n){var e=r.y;return n===undefined?e%2==0:n}));{var w=info.formatBits(n,e);var y=function(r){return!t&&(w>>r&1)==1};for(var p=0;p<6;p++)a.data[p][8]=y(p);for(var p=6;p<8;p++)a.data[p+1][8]=y(p);for(var p=8;p<15;p++)a.data[i-15+p][8]=y(p);for(var p=0;p<8;p++)a.data[8][i-p-1]=y(p);for(var p=8;p<9;p++)a.data[8][15-p-1+1]=y(p);for(var p=9;p<15;p++)a.data[8][15-p-1]=y(p);a.data[i-8][8]=!t}if(r>=7){var m=info.versionBits(r);for(var p=0;p<18;p+=1){var g=!t&&(m>>p&1)==1;var l=Math.floor(p/3);var d=p%3+i-8-3;a.data[l][d]=g;a.data[d][l]=g}}return a}function zigzag(r,n,e){var t=r.height;var i=PATTERNS[n];var a=-1;var o=t-1;for(var f=t-1;f>0;f-=2){if(f==6)f=5;for(;;o+=a){for(var u=0;u<2;u+=1){var v=f-u;if(r.data[o][v]!==undefined)continue;e(v,o,i(v,o))}if(o+a<0||o+a>=t)break}a=-a}}function detectType(r){var n="numeric";for(var e=0,t=r;e<t.length;e++){var i=t[e];if(info.alphabet.numeric.has(i))continue;n="alphanumeric";if(!info.alphabet.alphanumerc.has(i))return"byte"}return n}function utf8ToBytes(r){if(typeof r!=="string")throw new Error("utf8ToBytes expected string, got ".concat(typeof r));return new Uint8Array((new TextEncoder).encode(r))}function encode(r,n,e,t){var i="";var a=e.length;if(t==="numeric"){var o=info.alphabet.numeric.decode(e.split(""));var f=o.length;for(var u=0;u<f-2;u+=3)i+=bin(o[u]*100+o[u+1]*10+o[u+2],10);if(f%3===1){i+=bin(o[f-1],4)}else if(f%3===2){i+=bin(o[f-2]*10+o[f-1],7)}}else if(t==="alphanumeric"){var o=info.alphabet.alphanumerc.decode(e.split(""));var f=o.length;for(var u=0;u<f-1;u+=2)i+=bin(o[u]*45+o[u+1],11);if(f%2==1)i+=bin(o[f-1],6)}else if(t==="byte"){var v=utf8ToBytes(e);a=v.length;i=Array.from(v).map((function(r){return bin(r,8)})).join("")}else{throw new Error("encode: unsupported type")}var c=info.capacity(r,n).capacity;var d=bin(a,info.lengthBits(r,t));var s=info.modeBits[t]+d+i;if(s.length>c)throw new Error("Capacity overflow");s+="0".repeat(Math.min(4,Math.max(0,c-s.length)));if(s.length%8)s+="0".repeat(8-s.length%8);var h="1110110000010001";for(var l=0;s.length!==c;l++)s+=h[l%h.length];var w=Uint8Array.from(s.match(/(.{8})/g).map((function(r){return Number("0b".concat(r))})));return interleave(r,n).encode(w)}function drawQR(r,n,e,t,i){if(i===void 0){i=false}var a=drawTemplate(r,n,t,i);var o=0;var f=8*e.length;zigzag(a,t,(function(r,n,t){var i=false;if(o<f){i=(e[o>>>3]>>(7-o&7)&1)!==0;o++}a.data[n][r]=i!==t}));if(o!==f)throw new Error("QR: bytes left after draw");return a}function penalty(r){var n=r.inverse();var e=function(r){var n=0;for(var e=0,t=1,i=undefined;e<r.length;e++){if(i===r[e]){t++;if(e!==r.length-1)continue}if(t>=5)n+=3+(t-5);i=r[e];t=1}return n};var t=0;r.data.forEach((function(r){return t+=e(r)}));n.data.forEach((function(r){return t+=e(r)}));var i=0;var a=r.data;var o=r.width-1;var f=r.height-1;for(var u=0;u<o;u++){for(var v=0;v<f;v++){var c=u+1;var d=v+1;if(a[u][v]===a[c][v]&&a[c][v]===a[u][d]&&a[c][v]===a[c][d]){i+=3}}}var s=function(r){var n=[true,false,true,true,true,false,true];var e=[false,false,false,false];var t=__spreadArray(__spreadArray([],n,true),e,true);var i=__spreadArray(__spreadArray([],e,true),n,true);var a=0;for(var o=0;o<r.length;o++){if(includesAt(r,t,o))a+=40;if(includesAt(r,i,o))a+=40}return a};var h=0;for(var l=0,w=r.data;l<w.length;l++){var y=w[l];h+=s(y)}for(var p=0,m=n.data;p<m.length;p++){var g=m[p];h+=s(g)}var F=0;r.rectRead(0,Infinity,(function(r,n){return F+=n?1:0}));var G=F/(r.height*r.width)*100;var E=10*Math.floor(Math.abs(G-50)/5);return t+i+h+E}function drawQRBest(r,n,e,t){if(t===undefined){var i=best();for(var a=0;a<PATTERNS.length;a++)i.add(penalty(drawQR(r,n,e,a,true)),a);t=i.get()}if(t===undefined)throw new Error("Cannot find mask");return drawQR(r,n,e,t)}function validateECC(r){if(!ECMode.includes(r))throw new Error("Invalid error correction mode=".concat(r,". Expected: ").concat(ECMode))}function validateEncoding(r){if(!Encoding.includes(r))throw new Error("Encoding: invalid mode=".concat(r,". Expected: ").concat(Encoding));if(r==="kanji"||r==="eci")throw new Error("Encoding: ".concat(r," is not supported (yet?)."))}function validateMask(r){if(![0,1,2,3,4,5,6,7].includes(r)||!PATTERNS[r])throw new Error("Invalid mask=".concat(r,". Expected number [0..7]"))}function encodeQR(r,n,e){if(n===void 0){n="raw"}if(e===void 0){e={}}var t=e.ecc!==undefined?e.ecc:"medium";validateECC(t);var i=e.encoding!==undefined?e.encoding:detectType(r);validateEncoding(i);if(e.mask!==undefined)validateMask(e.mask);var a=e.version;var o,f=new Error("Unknown error");if(a!==undefined){validateVersion(a);o=encode(a,t,r,i)}else{for(var u=1;u<=40;u++){try{o=encode(u,t,r,i);a=u;break}catch(r){f=r}}}if(!a||!o)throw f;var v=drawQRBest(a,t,o,e.mask);v.assertDrawn();var c=e.border===undefined?2:e.border;if(!Number.isSafeInteger(c))throw new Error("Wrong border type=".concat(typeof c));v=v.border(c,false);if(e.scale!==undefined)v=v.scale(e.scale);if(n==="raw")return v.data;else if(n==="ascii")return v.toASCII();else if(n==="svg")return v.toSVG();else if(n==="gif")return v.toGIF();else if(n==="term")return v.toTerm();else throw new Error("Unknown output: ".concat(n))}export{encodeQR as e};
//# sourceMappingURL=index-f0bfb0c3.js.map